4. 데이터베이스 (Data Base)

```
4-1. 데이터베이스
4-2. Index
4-3. 정규화에 대하여
4-4. Transaction
4-5. 교착상태
4-6. Statement vs PreparedStatement
4-7. NoSQL
```

# Database

데이터베이스는 데이터의 집합이라고 볼 수 있다

DBMS의 정의

데이터베이스를 관리하고 운영하는 소프트웨어를 DBMS(Database Management System)이라고 한다. (엑셀은 아니다)

1. 대용량
2. 공유

DBMS의 종류

특정 목적을 처리하기 위한 프로그램

DB를 조작하기 위해 DBMS에서 수행되는 작업 단위

트랜잭션은 하나의 논리(작업) 단위  - 결과가 물리적으로 영향을 주지 않고 디스크에 쓰여지지 않는다(commit  명령 이후 반영)

때로는 다수 작업으로 구성될 수 있음

트랜잭션은 다른 트랜잭션과 분리되어 일관성과 신뢰성을 유지하는 작업

DB에 어떤 변화가 있는 경우를 말함

쪼개질 수 없는 업무 단위

안정성을 확보한다

예시)

은행 계좌 이체

송금자

1. 잔액 확인 (10만원 이상)
2. 잔액에서 10만원 빼기

수금자 

1. 잔액에 10만원 더하기

하나의 트랜젝션은 다른 트랜젝션과 분리

트랜젝션(모든 논리작업)이 성공하면 DB변화

실패하면 모든 논리 작업을 취소하고 원래 상태로 복귀

트랜잭션 속성- ACID 신맛 ㅋㅋ

4가지

A Atomicity 원자성

일부만 실행하고 종료 상태로 변경되면 안됨 → All or nothing

하나의 트랜젝션 안에 있는 모든 명령은 완벽히 수행되던지 모두 취소되던지 해야 한다.

C consistancy 일관성

트랜잭션이 완료되면 항상 일관성 있는 데이터 유지 - Must change affected data only in allowed ways (허락된 명령을 해야 함)

성공한 트랜잭션 결과 → 데이터베이스 상태는 모순되지 않음(일관된 상태)

트랜젝션 수정 시 오류가 없는 데이터만 저장하라 (일관성 있게 모순되지 않게)

I isolated 독립성, 격리성

둘 이상의 트랜젝션이 동시에 실행되는 경우 하나의 트랜젝션 실행에 다른 트랜잭션이 끼어들 수 없다

수행중인 트랜잭션은 완전히 완료될 때까지 다른 트랜잭션에서 수행 결과를 참조할 수 없다.

문제 있으면 roll back - 다시 처음으로 원위치

D durability 영속성

성공적으로 완료된 트랜잭션의 결과는 시스템이 고장나도 영구적으로 반영되어야 한다.

achieved by flushing the transcation’s log records to non-volatile storage before acknowledging commitment 커밋 전의 기록을 백업

트랜잭션 연산

Transaction Operations

commit

관계형 데이터베이스에서 트랜잭션을 끝내는 것

하드디스크에 영구적으로 적고 끝났음을 알려줌

rollback

원자성을 구현하기 위해 해당 트랜잭션이 수행한 모든 연산을 취소(Undo)(트랜잭션을 재시작하거나 취소함)

트랜잭션 로그를 기록

활성화(Active) : 트랜잭션이 작업을 시작하여 실행 중인 상태

실패(Failed) : 트랜잭션에 오류가 발생하여 실행이 중단된 상태

철회(Aborted) : 트랜잭션이 비정상적으로 종료되어 rollback연산을 수행한 상태

부분 완료(Partially commited) : 트랜잭션의 마지막 연산까지 실행하고 commit 요청이 들어온 직후의 상태, 최종 결과를 데이터베이스에 아직 반영하지 않은 상태

완료 (Commited) : 트랜잭션이 성공적으로 종료되어 commit 연산을 실행한 후의 상태

교착상태 (Deadlock)

개념

프로세스나 스레드가 결코 일어날 수 없는 특정 이벤트를 기다리는 상태

ex? 꽉 막힌 도로 - 누군가 교통정리 해줘야 한다

실제 시스템에서의 교착 상태 - 상호 거래 패턴

필요 조건

1. 상호 배제 조건(mutual exclusion condition)
2. 점유와 대기 조건(hold-and-wait condition)
3. 비선점 조건(nopreemption condition)
4. 순환 대기 조건(circular-wait condition)

해결법

교착 상태 무시 : 교착 상태가 드물게 발생하는 시스템에서 일반적으로 사용

윈도우나 유닉스 - 프로세스 자체 재부팅

교착 상태 탐지 및 복구

교착 상태가 자주 발생하는 시스템에서 일반적으로 사용하는 방법

왜 예방과 회피보다 일반적으로 탐지 및 복구를 사용할까?

교착 상태는 필요악

필요 조건 중 하나를 거부하고 예방 → 점유와 대기 조건을 거부한다면 자원을 효율적으로 사용할 수 없다.

교착 상태 회피

교착 상태를 인정하고 피해가자

대표적으로 은행원 알고리즘

- 시스템을 안전 상태/불안전 상태로 구분하고 불안전 상태일 때에는 대기킨다
- 할당할 자원 수 고정, 프로세스 수 고정, 제한된 시간안에 자원 반납 등 많은 조건 필요

교착 상태가 발생한 것 같을 때 탐지하고 복구하는 전략

자원을 요청할 때마다 시스템의 상태를 판단하고 회피하는 전략

교차착 상태 탐지

교착 상태 존재 여부 및 교착 상태에 연관된 프로세스와 자원을 알아내자

순환 대기 존재 여부에 초점을 맞춘다.

자원할당 그래프 소거

얼마나 자주 탐지 알고리즘을 호출?

주기적으로, 자원 즉시 할당 여부, CPU이용률
